

## FMR模型使用说明

### 原论文

Yang Yang, De-Chuan Zhan, Yin Fan, Yuan Jiang, and Zhi-Hua Zhou. Deep Learning for Fixed Model Reuse. Proceedings of the 31st AAAI Conference on Artificial Intelligence (AAAI-2017), San Francisco, CA. 2017.

### 前言：

该代码实现了基于FMR模型的多模态学习方法。原文的FMR模型可以基于文本模态提供固定特征，将图像模态设为迁移目标模型，也可以基于图片模态提供固定特征，将文本模态设为迁移目标模型。本代码的设定为后者，即图像模态提供固定特征，文本模态为迁移目标模型的设计。

### 数据集准备

本代码中使用的数据集为wiki数据集，数据集中包含文本和图像两种数据，文本需要下载预训练的词向量方便后续训练。具体数据集的下载参考以下链接。

数据集下载地址：http://www.svcl.ucsd.edu/projects/crossmodal/

### 数据集处理

本代码中使用的文本数据为预处理好的整数序列，保存在文件`data/all.json`中。主要是每个数据的文本和标签，文本已经处理成了整数的形式（每个整数和一个单词对应），与模型中的embedding一一对应。如需使用其他格式的文本数据，请进行相应更改。

数据处理方面，需要保证dataloader能够将数据和特征对应输出。

如果需要在其他数据集上使用本代码，请根据实际情况进行相应修改。

### 模型训练

模型`base_model`：一个torch.nn.Module对象，表示文本模型，提供可训练的特征。本代码中使用的是文本CNN模型，可根据需要进行更改。

本代码中使用的图像特征为预处理好的vgg19特征，特征维度为4096，保存在文件`image_vgg19_bn.pkl`中。如需使用其他特征，请进行相应更改。

#### 参数设置

在运行模型训练之前，需要根据实际情况设置一些参数。主要可调参数包括：

- `m`：每次knockdown的特征数量。
- `kd_step`：每隔多少epoch进行一次knockdown。
- `lr`：学习率。
- `weight decay`： 防止模型过度拟合的正则化技术。

#### 运行训练

设置好参数之后，可以直接运行`FMR_train.py`文件进行模型训练。训练过程中，代码会输出每个epoch的训练和测试准确率，以及最终的平均准确率。训练完成后，模型进行测试。测试过程中，代码会输出模型在测试集上的准确率。

该代码直接运行得到以下一组实验结果

| FMR        |       |       |       |       |       | FMR Average        |
| ---------- | ----- | ----- | ----- | ----- | ----- | ------------------ |
| 0.563      | 0.573 | 0.597 | 0.575 | 0.553 | 0.585 | 0.57433            |
| **No FMR** |       |       |       |       |       | **No FMR Average** |
| 0.567      | 0.569 | 559   | 0.585 | 0.541 | 0.538 | 0.55983            |


